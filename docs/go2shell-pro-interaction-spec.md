# go2shell Pro 交互规格（Phase 1 / V2）

## 1. 入口与信息架构

### 1.1 平台约束（必须遵守）
- Finder Sync 工具栏按钮点击后，系统会展示扩展提供的菜单。
- 因此工具栏入口无法实现“完全无菜单直开”。

### 1.2 入口优先级（修订）
- 右键菜单（主路径）：`Open in <Default Terminal>`，单击即执行。
- 工具栏菜单（降级路径）：保留最小菜单，首项为快速直达动作。
- 服务菜单：Phase 1 不启用。

### 1.3 工具栏菜单结构（最小化）
```
┌─ PathBridge ────────────────────────┐
├─ Quick Open in <Default Terminal>   │  ← 默认动作
├─ Open in...                          │  ← 可选，已安装终端列表
├──────────────────────────────────────┤
└─ Preferences...                      │
```

动态规则：
- 终端检测时机：菜单展开时检测，结果缓存 30 秒。
- 未安装终端：不在 `Open in...` 中显示。
- 最低保障：系统 Terminal 始终可用。

## 2. 选择规则与行为定义
Finder 选择解析优先级：
1. `selectedItemURLs()` 非空则使用选中项。
2. 否则使用 `targetedURL()`（当前目录）。

路径归一化规则：
- 选中文件：自动取父目录。
- 选中目录：直接使用目录。
- 多选同目录：默认聚合成单目录打开一次。
- 多选跨目录：默认“多窗口”；可在设置中改为“多标签”或“合并”。

## 3. 交互反馈
成功反馈：
- 默认静默成功（不弹窗）。
- Debug 模式可显示通知：`Opened in iTerm2: ~/project`。

失败反馈（必须可见）：
- 终端未安装：`目标终端不可用，已回退到默认终端`。
- 路径不可访问：`路径无访问权限`。
- 自动化失败（Apple Events）：提示系统授权路径。

## 4. 偏好设置页（主应用）

### 4.1 General
- 默认终端（下拉，仅列出已安装终端；Phase 1 首发支持 Terminal/iTerm2/Warp）
- 默认动作：新窗口 / 新标签 / 当前窗口
- 打开后激活到前台：是/否

### 4.2 Command Template
默认模板：
```bash
cd %PATH_QUOTED%; clear; pwd
```

支持占位符：
- `%PATH%`：目标目录完整路径
- `%PATH_QUOTED%`：带引号路径
- `%DIRNAME%`：目录名
- `%USER%`：当前用户名
- `%HOME%`：主目录

交互要求：
- 模板编辑框支持实时保存。
- 提供“恢复默认”按钮。
- Debug 模式显示解析后的最终命令预览。

### 4.3 Finder Extension
- `打开系统设置`：跳转到 Extensions 设置页（用户手动开启扩展）。
- `重启 Finder`：提供一键重启或明确操作提示。
- 显示当前扩展状态：已启用 / 未启用 / 未注册。

### 4.4 Quick Actions
- `Test Open`：执行一次默认终端打开测试。

### 4.5 Support
- 展示两张“感谢支持”二维码（本地资源）。
- 支持点击查看大图（不联网）。

## 5. 新手引导
首次启动引导 3 步：
1. 打开系统设置并启用 Finder 扩展。
2. 选择默认终端。
3. 点击 `Test Open` 验证链路。

## 6. 可用性指标（Phase 1）
- 主路径（右键入口）单击完成打开。
- P95 从触发到终端可用 < 1000ms。
- 三步内完成首次可用配置。
